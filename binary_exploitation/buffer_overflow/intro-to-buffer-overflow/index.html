
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../index-of_buffer-overflow/" rel="prev"/>
<link href="../case-studies/basic-rop/" rel="next"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.5.3, mkdocs-material-9.4.8" name="generator"/>
<title>intro-to-buffer-overflow - oscp_field_manual</title>
<link href="../../../assets/stylesheets/main.4b4a2bd9.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.356b1318.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="pink" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#intro-to-buffer-overflow">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="oscp_field_manual" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="oscp_field_manual">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            oscp_field_manual
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              intro-to-buffer-overflow
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="pink" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="pink" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="oscp_field_manual" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="oscp_field_manual">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    oscp_field_manual
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    home
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../geopolitical_concepts/">
<span class="md-ellipsis">
    geopolitical_concepts
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../index-of-oscp_field_manual/">
<span class="md-ellipsis">
    Index of oscp field manual
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../proof_of_concept/">
<span class="md-ellipsis">
    proof of concept
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    OPCODE DICTIONARY
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            OPCODE DICTIONARY
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../OPCODE_DICTIONARY/x86-64/">
<span class="md-ellipsis">
    x86-64 Instruction Set
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Binary exploitation
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Binary exploitation
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../binary_exploitation-home/">
<span class="md-ellipsis">
    binary_exploitation-home
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../index-of-binary_exploitation/">
<span class="md-ellipsis">
    Index of binary exploitation
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../shellcode/">
<span class="md-ellipsis">
    shellcode
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_6_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
<span class="md-ellipsis">
    Buffer overflow
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_6_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_4">
<span class="md-nav__icon md-icon"></span>
            Buffer overflow
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../index-of_buffer-overflow/">
<span class="md-ellipsis">
    Index of buffer overflow
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    intro-to-buffer-overflow
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    intro-to-buffer-overflow
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#theory-stack-based-buffer-overflow">
    theory - stack based buffer overflow
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#a-note-on-delivery-methods">
    a note on delivery methods
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#methodology">
    methodology
  </a>
<nav aria-label="methodology" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#calculating-the-offset-of-saved-rip">
    calculating the offset of saved RIP
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nop-sled-guarantee-correct-return-address-bypass-address-randomization">
    NOP sled - guarantee correct return address - bypass address randomization
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rop-chains-bypassing-data-execution-prevention">
    ROP chains - bypassing Data Execution Prevention
  </a>
<nav aria-label="ROP chains - bypassing Data Execution Prevention" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#theory">
    theory
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#procedure">
    procedure
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6_4_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_4_3" id="__nav_6_4_3_label" tabindex="0">
<span class="md-ellipsis">
    Case studies
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_4_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_6_4_3">
<span class="md-nav__icon md-icon"></span>
            Case studies
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../case-studies/basic-rop/">
<span class="md-ellipsis">
    basic-rop
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../case-studies/index-of_buffer-overflow_case-studies/">
<span class="md-ellipsis">
    Index of buffer overflow case studies
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../case-studies/pico_ctf_bo2/">
<span class="md-ellipsis">
    pico_ctf_bo2
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="0">
<span class="md-ellipsis">
    Shared library highjacking
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_5">
<span class="md-nav__icon md-icon"></span>
            Shared library highjacking
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../shared-library-highjacking/index-of_shared-library-hijacking/">
<span class="md-ellipsis">
    Index of shared library hijacking
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6_5_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_5_2" id="__nav_6_5_2_label" tabindex="0">
<span class="md-ellipsis">
    Linux shared libs
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_5_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_6_5_2">
<span class="md-nav__icon md-icon"></span>
            Linux shared libs
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../shared-library-highjacking/linux-shared-libs/LD_PRELOAD-function-hooking/">
<span class="md-ellipsis">
    LD_PRELOAD-function-hooking
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../shared-library-highjacking/linux-shared-libs/index-of_linux-shared-libs/">
<span class="md-ellipsis">
    Index of linux shared libs
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-ellipsis">
    Docker
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            Docker
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../docker/index-of-docker/">
<span class="md-ellipsis">
    Index of docker
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
<span class="md-ellipsis">
    Docker escapes
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_2">
<span class="md-nav__icon md-icon"></span>
            Docker escapes
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../docker/docker_escapes/index-of-docker_escapes/">
<span class="md-ellipsis">
    Index of docker escapes
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../docker/docker_escapes/via-docker-socket/">
<span class="md-ellipsis">
    via-docker-socket
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-ellipsis">
    Firewall evasion
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            Firewall evasion
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../firewall_evasion/firewall_evasion-home/">
<span class="md-ellipsis">
    general firewall evasion tactics
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../firewall_evasion/index-of-firewall_evasion/">
<span class="md-ellipsis">
    Index of firewall evasion
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_9" type="checkbox"/>
<label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
<span class="md-ellipsis">
    Freedom of movement
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_9_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_9">
<span class="md-nav__icon md-icon"></span>
            Freedom of movement
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/bash_isms/">
<span class="md-ellipsis">
    bash_isms
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/cmdline_analysis/">
<span class="md-ellipsis">
    cmdline_analysis
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/docker/">
<span class="md-ellipsis">
    Docker
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/find_command/">
<span class="md-ellipsis">
    The Find Command
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/freedom_of_movement/">
<span class="md-ellipsis">
    freedom of movement
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/gpg/">
<span class="md-ellipsis">
    gpg
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/index-of-freedom_of_movement/">
<span class="md-ellipsis">
    Index of freedom of movement
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/powershell_cheatsheet/">
<span class="md-ellipsis">
    PowerShell Movements
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/serving_files/">
<span class="md-ellipsis">
    methods of serving to victims
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/tmux/">
<span class="md-ellipsis">
    tmux
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/tshark/">
<span class="md-ellipsis">
    tshark
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/vi_or_vim/">
<span class="md-ellipsis">
    vi_or_vim
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_9_13" type="checkbox"/>
<label class="md-nav__link" for="__nav_9_13" id="__nav_9_13_label" tabindex="0">
<span class="md-ellipsis">
    Services
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_9_13_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_9_13">
<span class="md-nav__icon md-icon"></span>
            Services
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/services/dns/">
<span class="md-ellipsis">
    DNS
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/services/ftp/">
<span class="md-ellipsis">
    ftp specific movements
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/services/index-of-services/">
<span class="md-ellipsis">
    Index of services
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/services/smb/">
<span class="md-ellipsis">
    smb specific movements
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_9_13_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_9_13_5" id="__nav_9_13_5_label" tabindex="0">
<span class="md-ellipsis">
    Databases
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_9_13_5_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_9_13_5">
<span class="md-nav__icon md-icon"></span>
            Databases
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/services/databases/MySql/">
<span class="md-ellipsis">
    MySQL
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/services/databases/NoSQL_MongoDB/">
<span class="md-ellipsis">
    NoSQL_MongoDB
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/services/databases/index-of-databases/">
<span class="md-ellipsis">
    Index of databases
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_9_14" type="checkbox"/>
<label class="md-nav__link" for="__nav_9_14" id="__nav_9_14_label" tabindex="0">
<span class="md-ellipsis">
    Software
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_9_14_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_9_14">
<span class="md-nav__icon md-icon"></span>
            Software
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/software/burpsuite/">
<span class="md-ellipsis">
    burpsuite
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/software/index-of-software/">
<span class="md-ellipsis">
    Index of software
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/software/web-browser/">
<span class="md-ellipsis">
    Hotkeys &amp; keystokes
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../freedom_of_movement/software/wireshark/">
<span class="md-ellipsis">
    wireshark
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_10" type="checkbox"/>
<label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
<span class="md-ellipsis">
    Hash cracking
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_10_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_10">
<span class="md-nav__icon md-icon"></span>
            Hash cracking
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../hash_cracking/hashcat/">
<span class="md-ellipsis">
    basic guide to hashcat
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../hash_cracking/index-of-hash_cracking/">
<span class="md-ellipsis">
    Index of hash cracking
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_11" type="checkbox"/>
<label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
<span class="md-ellipsis">
    Linux
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_11_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_11">
<span class="md-nav__icon md-icon"></span>
            Linux
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../linux/index-of-linux/">
<span class="md-ellipsis">
    Index of linux
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../linux/lin_enumeration/">
<span class="md-ellipsis">
    linux_enumeration
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../linux/persistence/">
<span class="md-ellipsis">
    persistence
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../linux/proc-pseudo-file-system/">
<span class="md-ellipsis">
    proc-pseudo-file-system
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_12" type="checkbox"/>
<label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
<span class="md-ellipsis">
    Metasploit framework
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_12_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_12">
<span class="md-nav__icon md-icon"></span>
            Metasploit framework
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../metasploit_framework/index-of-metasploit_framework/">
<span class="md-ellipsis">
    Index of metasploit framework
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../metasploit_framework/msfconsole/">
<span class="md-ellipsis">
    msfconsole
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../metasploit_framework/msfvenom/">
<span class="md-ellipsis">
    msfvenom
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../metasploit_framework/searchsploit/">
<span class="md-ellipsis">
    searchsploit cheat sheet
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_13" type="checkbox"/>
<label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
<span class="md-ellipsis">
    Report writing
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_13_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_13">
<span class="md-nav__icon md-icon"></span>
            Report writing
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../report_writing/index-of-report_writing/">
<span class="md-ellipsis">
    Index of report writing
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../report_writing/md_cheatsheet/">
<span class="md-ellipsis">
    Md cheatsheet
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../report_writing/report_writing-home/">
<span class="md-ellipsis">
    Report writing home
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_14" type="checkbox"/>
<label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
<span class="md-ellipsis">
    Shells
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_14_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_14">
<span class="md-nav__icon md-icon"></span>
            Shells
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../shells/C2-Frameworks/">
<span class="md-ellipsis">
    C2-Frameworks
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../shells/index-of-shells/">
<span class="md-ellipsis">
    Index of shells
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../shells/link_dump/">
<span class="md-ellipsis">
    shell resources
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../shells/shell_upgrades/">
<span class="md-ellipsis">
    shell_upgrades
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../shells/shells-home/">
<span class="md-ellipsis">
    general methodology for sending shells
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../shells/webshells/">
<span class="md-ellipsis">
    php webshells
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../shells/windows_shells/">
<span class="md-ellipsis">
    windows_shells
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_15" type="checkbox"/>
<label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
<span class="md-ellipsis">
    Web
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_15_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_15">
<span class="md-nav__icon md-icon"></span>
            Web
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../web/index-of-web/">
<span class="md-ellipsis">
    Index of web
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_15_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_15_2" id="__nav_15_2_label" tabindex="0">
<span class="md-ellipsis">
    Weaponizing common vulnerabilities
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_15_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_15_2">
<span class="md-nav__icon md-icon"></span>
            Weaponizing common vulnerabilities
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../web/weaponizing-common-vulnerabilities/LFI-and-SMTP-gives-RCE/">
<span class="md-ellipsis">
    LFI-and-SMTP-gives-RCE
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../web/weaponizing-common-vulnerabilities/index-of-weaponizing-common-vulnerabilities/">
<span class="md-ellipsis">
    Index of weaponizing common vulnerabilities
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../web/weaponizing-common-vulnerabilities/purpose-of-weaponizing-common-vulnerabilities/">
<span class="md-ellipsis">
    purpose-of-weaponizing-common-vulnerabilities
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_15_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_15_3" id="__nav_15_3_label" tabindex="0">
<span class="md-ellipsis">
    Web enumeration
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_15_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_15_3">
<span class="md-nav__icon md-icon"></span>
            Web enumeration
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../web/web_enumeration/creative_enumeration/">
<span class="md-ellipsis">
    creative enumeration methods
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../web/web_enumeration/domain_enumeration/">
<span class="md-ellipsis">
    domain_enumeration
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../web/web_enumeration/general_methodology/">
<span class="md-ellipsis">
    general_methodology
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../web/web_enumeration/index-of-web_enumeration/">
<span class="md-ellipsis">
    Index of web enumeration
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../web/web_enumeration/opensource_targets/">
<span class="md-ellipsis">
    opensource_targets
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../web/web_enumeration/php_flavor_site/">
<span class="md-ellipsis">
    php_flavor_site
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_16" type="checkbox"/>
<label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
<span class="md-ellipsis">
    Windows
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_16_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_16">
<span class="md-nav__icon md-icon"></span>
            Windows
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../windows/index-of-windows/">
<span class="md-ellipsis">
    Index of windows
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../windows/win_enumeration/">
<span class="md-ellipsis">
    win_enumeration
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../windows/win_facts/">
<span class="md-ellipsis">
    win_facts
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../windows/win_killchain/">
<span class="md-ellipsis">
    win_killchain
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../windows/win_toolset/">
<span class="md-ellipsis">
    win_toolset
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_16_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_16_6" id="__nav_16_6_label" tabindex="0">
<span class="md-ellipsis">
    Active directory
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_16_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_16_6">
<span class="md-nav__icon md-icon"></span>
            Active directory
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../windows/active-directory/active-directory-fundamentals/">
<span class="md-ellipsis">
    active-directory-fundamentals
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../windows/active-directory/if_then_enumerations/">
<span class="md-ellipsis">
    if_then_enumerations
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../windows/active-directory/index-of-active-directory/">
<span class="md-ellipsis">
    Index of active directory
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../windows/active-directory/kerberoasting-and-other-hash-attacks/">
<span class="md-ellipsis">
    kerberoasting-and-other-hash-attacks
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../windows/active-directory/ldap/">
<span class="md-ellipsis">
    ldap
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_16_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_16_7" id="__nav_16_7_label" tabindex="0">
<span class="md-ellipsis">
    Win post exploitation
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_16_7_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_16_7">
<span class="md-nav__icon md-icon"></span>
            Win post exploitation
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../windows/win_post_exploitation/Introduction/">
<span class="md-ellipsis">
    Post Exploitation
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#theory-stack-based-buffer-overflow">
    theory - stack based buffer overflow
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#a-note-on-delivery-methods">
    a note on delivery methods
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#methodology">
    methodology
  </a>
<nav aria-label="methodology" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#calculating-the-offset-of-saved-rip">
    calculating the offset of saved RIP
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#nop-sled-guarantee-correct-return-address-bypass-address-randomization">
    NOP sled - guarantee correct return address - bypass address randomization
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rop-chains-bypassing-data-execution-prevention">
    ROP chains - bypassing Data Execution Prevention
  </a>
<nav aria-label="ROP chains - bypassing Data Execution Prevention" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#theory">
    theory
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#procedure">
    procedure
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="intro-to-buffer-overflow">intro-to-buffer-overflow<a class="headerlink" href="#intro-to-buffer-overflow" title="Permanent link">¶</a></h1>
<h2 id="theory-stack-based-buffer-overflow">theory - stack based buffer overflow<a class="headerlink" href="#theory-stack-based-buffer-overflow" title="Permanent link">¶</a></h2>
<blockquote>
<p>When compiling examples, dissable address randomization and stack protections. Use <code>gcc -fno-stack-protector -z exec stack</code> and ensure that <code>/proc/sys/kernel/randomize_va_space</code> has value 1.</p>
</blockquote>
<p>This category of exploits work because of the nature of the data structure called the stack. To accelerate our discussion, here are a few aspects of the stack data structure:</p>
<ul>
<li>used to store variables which have size/length at compilation time</li>
<li>bytes get added to or removed from the stack with <code>push</code> and <code>pop</code> assembly instructions respectively</li>
<li>the value of <code>rsp</code> register is an address that points to the most recent value added to the stack</li>
<li>the value of <code>rbp</code> register is an address that points to the base of the stack frame</li>
<li>during execution, each function gets its own stack frame</li>
<li>when a value is added to the stack, the address inside <code>rsp</code> is <em>decremented</em>. <strong>This is the fundamental feature that enables the exploit</strong>. </li>
<li>when we write bytes to some location on the stack, consecutive bytes are written by <em>incrementing</em> the address we are writing to. Therefore whenever we write to the stack, if we mis manager our pointer then <strong>we may overwrite data previously pushed to the stack.</strong></li>
</ul>
<p>The intuition so far may be, "so what? we can overwrite data, maybe break something". However, it becomes clear how this can be weaponized once we examine exectution flow control. A major aspect of flow control is implemented by the stack, that being return addressing. When a function is called, we need a way to continue to execute the assembly instructions once the function has finished its work. When <code>functionA</code> calls <code>functionB</code> a new stack frame is built and two important values are saved onto the stack by doing <code>push</code> instructions. </p>
<ol>
<li><code>push rip</code></li>
<li><code>push rbp</code></li>
</ol>
<blockquote>
<p>these values will be referred to as "saved <code>rip</code>" and "saved <code>rbp</code>", note that saved <code>rbp</code> is at a lower memory address than saved <code>rip</code> due to how the stack is implemented. </p>
</blockquote>
<p>The register <code>rip</code> contains an address that points to the next assembly instruction, by saving the value of <code>rip</code> on the stack, we can easily pick up where we left off after <code>functionB</code> finishes its work. Note that <code>rbp</code> is saved to the stack so that the context/scope of <code>functiionA</code> can easily be resumed, <code>rbp</code> being saved on the stack is not fundamental to achieving code execution. </p>
<p>Time to put it all together. When user input is stored on the stack, there is a possibility of this exploit occurring. Without proper controls, a user may provide longer and longer inputs. When these inputs are stored on the stack at some address, they are written by increasing the address for each consecutive byte. With sufficiently large input, the size of the stack frame may be exhausted, overwriting  <code>functionA</code> 's  saved <code>rbp</code> value, and overwriting <code>functionA</code>'s saved <code>rip</code> value to any address the user wants. When <code>functionB</code> returns, instead of returning to <code>functionA</code>'s next instruction, execution returns to the address provided by the user.</p>
<p>The impacts of this are limited to our own creativity and the size of the buffer on the stack. The traditional way to get arbitrary code execution is to overwrite saved <code>rip</code> to be an address inside the buffer we can write to.  This is more easily done when access to the binary is available and we can debug to hunt for addresses. When debugging is not an option but binary is still available locally, spraying the buffer and hunting for relevant <code>dmesg</code> output is the best starting point. </p>
<h2 id="a-note-on-delivery-methods">a note on delivery methods<a class="headerlink" href="#a-note-on-delivery-methods" title="Permanent link">¶</a></h2>
<p>How the payload is delivered to the target and the buffer our target binary uses to receive the payload can significantly impact the exploitation process. Some example delivery/receipt methods are:</p>
<ul>
<li>Remote/network<ul>
<li>netcat, telnet, socat</li>
</ul>
</li>
<li>Is the binary reading from <code>stdin</code> or a command line argument such as <code>argv[1]</code>? </li>
<li>Internal to the program? At some point after execution has begun.</li>
</ul>
<p>In particular, shell interpreters such as <code>bash</code> will introduce tokenization errors in our payload since <code>0xff</code> and <code>0x0a</code> are considered white space and will cause our payload to be split over several <code>argv</code> indexes. For remote delivery, telnet and netcat handle the <code>enter</code> key differently, this can affect how the payload is delivered, potentially breaking it up into tokens. </p>
<p>To mitigate these issues, the following should be considered:</p>
<ul>
<li>is the target source code available?</li>
<li>what tests can we conduct to determine if our payload is being tokenized?</li>
<li>for <code>bash</code>-like interpreters we can force our payload into a single token by implementing <code>""$(cat payload.txt)""</code>, the <code>"</code> characters allow substitutions, thus forcing our payload into <code>argv[1]</code></li>
</ul>
<p>Experience should be valued over theory when preparing for a campaign that includes binary exploitation.  </p>
<h2 id="methodology">methodology<a class="headerlink" href="#methodology" title="Permanent link">¶</a></h2>
<h3 id="calculating-the-offset-of-saved-rip">calculating the offset of saved RIP<a class="headerlink" href="#calculating-the-offset-of-saved-rip" title="Permanent link">¶</a></h3>
<p>The debugger <code>gdb-peda</code> offers tools for exploit development implemented in python. Below is procedure for getting the offset of saved <code>rip</code>:</p>
<ol>
<li>debug the binary with <code>gdb-peda</code></li>
<li>set breakpoint on <code>functionA</code> that calls <code>functionB</code>. Note that <code>funcitonB</code> contains the vulnerable buffer. Often <code>functionA</code> is simply <code>main</code></li>
<li>use <code>pattern_create 500 pattern.txt</code> to write a file containing a non repeating sequence. Note these are often implemented as Debruijn sequences.</li>
<li>run the binary with the pattern in the buffer, <code>run &lt; pattern.txt</code> for standard input or <code>run $(cat pattern.txt)</code> for <code>arvg[1]</code></li>
<li>continue until program crashes, the current value of <code>rsp</code> is the address we tried to return to. We can print it via <code>x/wx $rsp</code>.  Call this <code>FAILED_RET</code>. It is at this time where we measure addresses for <code>NOP</code> sled technique or estimate address spaces if address space randomization is implemented. Stack crash analysis should be done at this point. </li>
<li>We now need to find <code>FAILED_RET</code>, in our pattern. <code>gdb-peda</code> does this for us via <code>pattern_offset FAILED_RET</code></li>
<li><code>gdb-peda</code> yields the offset, lets say <code>n</code>. We can now build our payload. Note we will only have <code>n</code> bytes to include any shellcode, padding etc, that we want for our exploit.</li>
</ol>
<pre><code class="language-python">"A"*n + DESIRED_ADDRESS_LITTLE_ENDIAN
</code></pre>
<h3 id="nop-sled-guarantee-correct-return-address-bypass-address-randomization">NOP sled - guarantee correct return address - bypass address randomization<a class="headerlink" href="#nop-sled-guarantee-correct-return-address-bypass-address-randomization" title="Permanent link">¶</a></h3>
<p>One difficulty associated with buffer overflow is finding which address to use when overwriting saved <code>rip</code> . This is further complicated when the system has robustly implemented address space layout randomization (ASLR), that is on process creation <em>not simply at boot time</em>. We can reduce these challenges by utilizing a <code>NOP</code> sled. A <code>NOP</code> is an assembly instruction that results in <em>no operation</em>, it takes a moment of time, then proceeds to the next instruction. Understanding of the intended usage of <code>NOP</code>s is not necessary for the exploit.</p>
<p><img alt="nop-sled-image.png" src="../../../pics/nop-sled-image.png"/></p>
<p>By using the byte <code>\x90</code> as padding, we can overwrite saved <code>rip</code> to point at any of <code>NOP</code>s in the buffer. Address of a <code>NOP</code> should be calculated at the same point in debugging as when we calculate the <code>SAVED_RIP</code> offset. </p>
<p><img alt="nop-buffer-overflow-exectution-flow.png" src="../../../pics/nop-buffer-overflow-exectution-flow.png"/></p>
<p>This is especially potent when conditions reduce the amount of starting knowledge we can get about the binary.  Technique is powerful for implementing brute force solutions with scripting languages or for remote exploits.</p>
<h3 id="rop-chains-bypassing-data-execution-prevention">ROP chains - bypassing Data Execution Prevention<a class="headerlink" href="#rop-chains-bypassing-data-execution-prevention" title="Permanent link">¶</a></h3>
<h4 id="theory">theory<a class="headerlink" href="#theory" title="Permanent link">¶</a></h4>
<p>Data execution prevention is a policy implemented at compile time that stops execution from within the data section of the binary. The buffers we have been exploited thus far are all contained in the data section, this policy disables all of our established methods.</p>
<p>What we can do instead is leverage return oriented programming to "live off the land", using what is within the valid sections of the image to achieve what we want. With a library such as <code>libc</code>  (contains system calls) included in the image, we can get access to relevant strings such as</p>
<ul>
<li><code>/bin/sh</code></li>
<li><code>system()</code></li>
<li><code>execve()</code></li>
<li><code>dup2()</code></li>
<li><code>NULL</code></li>
<li>more can be found by debugging with <code>gdb-peda</code> and using <code>find</code> to search for strings</li>
</ul>
<h4 id="procedure">procedure<a class="headerlink" href="#procedure" title="Permanent link">¶</a></h4>
<p>To build a ROP chain, we need to </p>
<ol>
<li>get the offset of saved <code>rip</code></li>
<li>we need addresses of relevant assembly instructions in the image</li>
<li>we need to respect calling convention, so to execute <code>system("/bin/sh")</code> we must first load the string into <code>rdi</code> then return to the address of <code>system()</code> i.e. <code>__libc_system</code></li>
<li>we achieve this through gadgets, we overwrite saved <code>rip</code> to point to the gadget <code>pop rdi; ret</code></li>
<li>When the vulnerable function returns to the address of our gadget, <strong>calling convention causes stack frame to be collapsed</strong>, resulting in <code>rsp</code>  pointing to whatever was after saved <code>rip</code> in our payload. Therefore <code>rsp</code> is pointing to the correct position for the <code>pop</code> instruction. </li>
</ol>
<p>Okay, that's great. <em>How do I get the address ?</em> If debugging is available, <code>gdb-peda</code> has two essential capabilities </p>
<ol>
<li><code>find STRING_GOES_HERE</code> for finding string addresses</li>
<li><code>asmsearch  pop ?; ret</code> for finding <strong>any</strong> <code>pop</code> instructions, followed by <code>ret</code></li>
</ol>
<p>If debugging is unavailable, then it possible to remotely expose base addresses through the <code>/proc</code> file system. This is particularly attractive due to <code>/proc</code> frequently being accessible through remote information disclosure methods such as remote file inclusion. </p>
<ol>
<li>get base addresses from <code>/proc</code></li>
<li>get offsets from the <code>libc.so.6</code> on your local system, may need to hunt versions if target is out of date</li>
<li>perform the calculation then proceed as detailed above</li>
</ol>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy"], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../../assets/javascripts/bundle.81fa17fe.min.js"></script>
<script src="../../../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</body>
</html>